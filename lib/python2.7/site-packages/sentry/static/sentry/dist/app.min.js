app=window.app={config:{},templates:{},utils:{}},function(t,e){"use strict";t.models={},t.models.Group=e.Model.extend({defaults:{count:0,version:0,annotations:[],tags:[],hasSeen:!1,isBookmarked:!1,historicalData:[]}})}(app,Backbone),function(t){"use strict";t.templates={group:'<div class="count" data-count="<%= app.utils.formatNumber(count) %>"><span title="<%= count %>"><%= app.utils.formatNumber(count) %></span></div><div class="details"><h3><a href="<%= permalink %>"><%= title %></a></h3><p class="message"><%= message %></p><div class="meta"><% $.each(annotations, function(_, tag) { %><span class="tag annotation" data-tag="<%= tag.label %>" data-count="<%= app.utils.formatNumber(tag.count) %>"><i><%= tag.label %></i><span title="<%= count %>"><%= app.utils.formatNumber(tag.count) %></span></span><% }) %><span class="last-seen pretty-date"></span><% if (timeSpent) { %><span class="tag time-spent"><%= Math.round(timeSpent) %>ms</span><% } %><span class="tag tag-project"><a href="<%= projectUrl %>"><%= project.name %></a></span><span class="tag tag-logger"><a href="<%= loggerUrl %>"><%= logger %></a></span><% _.each(tags, function(tag){ %> <span class="tag"><%= tag %></span><% }) %></div><span class="sparkline"></span><ul class="actions"><% if (canResolve) { %><li><a href="#" data-action="resolve"><i aria-hidden="true" class="icon-checkmark"></i></a></li><li><a href="#" data-action="bookmark" class="bookmark"><i aria-hidden="true" class="icon-star"></i></a></li><% } %></ul></div>'}}(app),function(t,e,i,a){"use strict";var n=e,s=[[1e9,"b"],[1e6,"m"],[1e3,"k"]];t.utils={getQueryParams:function(){var t,e,i={},a=window.location.href;return-1==a.indexOf("?")?i:(t=a.slice(a.indexOf("?")+1,-1!=a.indexOf("#")?a.indexOf("#"):a.length).split("&"),n.each(t,function(t,a){e=a.split("="),(e[0]||e[1])&&(i[decodeURIComponent(e[0])]=e[1]?decodeURIComponent(e[1]).replace(/\+/," "):"")}),i)},floatFormat:function(t,e){var i=Math.pow(10,e);return parseInt(t*i,10)/i},formatNumber:function(t){var e,i,a,n,o;t=parseInt(t,10);for(var r=0;e=s[r];r++)if(i=e[0],a=e[1],n=Math.floor(t/i),o=t%i,n>0)return n/10>1||!o?""+n+a:""+this.floatFormat(t/i,1)+a;return""+t},slugify:function(t){t=t.replace(/^\s+|\s+$/g,""),t=t.toLowerCase();for(var e="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",i="aaaaeeeeiiiioooouuuunc------",a=0,n=e.length;n>a;a++)t=t.replace(new RegExp(e.charAt(a),"g"),i.charAt(a));return t=t.replace(/[^a-z0-9\s\-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},varToggle:function(t,e){var i=n(t);i.attr("data-expand-label")||i.attr("data-expand-label",i.html()),e.toggle(),i.html(e.is(":visible")?i.attr("data-collapse-label"):i.attr("data-expand-label"))},getSearchUsersUrl:function(){return t.config.urlPrefix+"/api/"+t.config.organizationId+"/users/search/"},getSearchProjectsUrl:function(){return t.config.urlPrefix+"/api/"+t.config.organizationId+"/projects/search/"},getSearchTagsUrl:function(){return t.config.urlPrefix+"/api/"+t.config.organizationId+"/"+t.config.projectId+"/tags/search/"},makeSearchableInput:function(t,e,i,a){n(t).select2(n.extend({allowClear:!0,width:"element",initSelection:function(t,e){var i=n(t);e({id:i.val(),text:i.val()})},ajax:{url:e,dataType:"json",data:function(t,e){return{query:t,limit:10}},results:function(t,e){i(t);return{results:i(t)}}}},a||{}))},escape:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},makeSearchableUsersInput:function(t){this.makeSearchableInput(t,this.getSearchUsersUrl(),i.bind(function(t){var e=[];return n(t.results).each(i.bind(function(t,i){var a;a=i.first_name?this.escape(i.first_name)+" &mdash; "+this.escape(i.username):this.escape(i.username),a+="<br>"+this.escape(i.email),e.push({id:i.username,text:a})},this)),t.query&&0===n(e).filter(function(){return 0===this.id.localeCompare(t.query)}).length&&e.push({id:this.escape(t.query),text:this.escape(t.query)}),e},this),{escapeMarkup:function(t){return t}})},parseLinkHeader:function(t){if(null===t)return{};var e=t.split(","),i={};return n.each(e,function(t,e){var a=/<([^>]+)>; rel="([^"]+)"/g.exec(e);i[a[2]]=a[1]}),i}},n(function(){n(".body select").each(function(){var t=n(this),e={width:"element",allowClear:!1,minimumResultsForSearch:10};t.attr("data-allowClear")&&(e.allowClear=t.attr("data-allowClear")),t.select2(e)}),setInterval(function(){n(".pretty-date").each(function(t,e){var i=n(e),s=i.data("datetime");if(s){var o=a(s);o&&(i.text(o.fromNow()),i.attr("title",o.format("llll")))}})},5e3)})}(app,jQuery,_,moment),function(t,e){"use strict";t.ScoredList=e.Collection.extend({comparator:function(t){return-t.get("score")}})}(app,Backbone),function(t,e,i,a){"use strict";var n=i;t.charts={render:function(e,i){var s=n(e),o=(s.attr("data-api-url"),n(e).attr("data-title"),s.find(".sparkline"));o.height(s.height()),n.ajax({url:s.attr("data-api-url"),type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-86400,resolution:"1h"},success:function(e){var s=[],r=10;o.empty(),n.each(e,function(t,e){var i=new Date(1e3*e[0]);s.push({y:e[1],label:a(i).fromNow()}),e[1]>r&&(r=e[1])}),t.charts.createSparkline(o,s,i)}})},createSparkline:function(e,i,a){var s,o,r,l,c=n(e),d=c.children(),h=10;void 0===a&&(a={});for(var p=0;p<i.length;p++)o=i[p],"number"==typeof o&&(o=i[p]={y:o}),o.y>h&&(h=o.y);for(l=t.utils.floatFormat(100/i.length,2)+"%",p=0;p<i.length;p++)o=i[p],r=t.utils.floatFormat(o.y/h*99,2)+"%",s=o.y+" events",o.label&&(s=s+"<br>("+o.label+")"),void 0===d.get(p)?n('<a style="width:'+l+';" rel="tooltip" title="'+s+'"><span style="height:'+r+'">'+o.y+"</span></a>").tooltip({placement:a.placement||"bottom",html:!0,container:"body"}).appendTo(c):n(d[p]).find("span").css("height",r).text(o.y).attr("title",o.label||o.y)}}}(app,Backbone,jQuery,moment),function(t,e,i,a,n,s){"use strict";var o=a;e.GroupView=i.View.extend({tagName:"li",className:"group",template:n.template(e.templates.group),initialize:function(){i.View.prototype.initialize.apply(this,arguments),n.bindAll(this,"updateCount","updateAllAnnotations","updateAnnotation","updateLastSeen","updateResolved","updateHasSeen","renderSparkline","updateBookmarked","render"),this.model.on({"change:count":this.updateCount,"change:annotations":this.updateAllAnnotations,"change:lastSeen":this.updateLastSeen,"change:isBookmarked":this.updateBookmarked,"change:isResolved":this.updateResolved,"change:hasSeen":this.updateHasSeen,"change:historicalData":this.renderSparkline},this)},render:function(){var t=this.model.toJSON();t.projectUrl=e.config.urlPrefix+"/"+e.config.organizationId+"/"+t.project.slug+"/",t.loggerUrl=t.projectUrl+"?logger="+t.logger,this.$el.html(this.template(t)),this.$el.attr("data-id",this.model.id),this.$el.addClass(this.getLevelClassName()),this.$el.find("a[data-action=resolve]").click(n.bind(function(t){t.preventDefault(),this.model.get("isResolved")?this.unresolve():this.resolve()},this)),this.$el.find("a[data-action=bookmark]").click(n.bind(function(t){t.preventDefault(),this.bookmark()},this)),this.updateLastSeen(),this.renderSparkline(),this.updateResolved(),this.updateHasSeen(),this.updateBookmarked()},updateBookmarked:function(){this.model.get("isBookmarked")?this.$el.find("a[data-action=bookmark]").addClass("checked"):this.$el.find("a[data-action=bookmark]").removeClass("checked")},updateResolved:function(){this.model.get("isResolved")?this.$el.addClass("resolved"):this.$el.removeClass("resolved")},updateHasSeen:function(){this.model.get("hasSeen")?this.$el.addClass("seen"):this.$el.removeClass("seen")},renderSparkline:function(t){var i=this.model.get("historicalData");i&&i.length&&(this.$el.addClass("with-sparkline"),e.charts.createSparkline(this.$el.find(".sparkline"),i))},resolve:function(){o.ajax({url:this.getResolveUrl(),type:"post",dataType:"json",success:n.bind(function(t){this.model.set("version",t.version+5e3),this.model.set("isResolved",!0)},this)})},unresolve:function(){o.ajax({url:this.getUnresolveUrl(),type:"post",dataType:"json",success:n.bind(function(t){this.model.set("version",t.version+5e3),this.model.set("isResolved",!1)},this)})},getResolveUrl:function(){return e.config.urlPrefix+"/api/"+e.config.organizationId+"/"+e.config.projectId+"/group/"+this.model.get("id")+"/set/resolved/"},getUnresolveUrl:function(){return e.config.urlPrefix+"/api/"+e.config.organizationId+"/"+e.config.projectId+"/group/"+this.model.get("id")+"/set/unresolved/"},getBookmarkUrl:function(){return e.config.urlPrefix+"/api/"+e.config.organizationId+"/"+e.config.projectId+"/bookmark/"},bookmark:function(){o.ajax({url:this.getBookmarkUrl(),type:"post",dataType:"json",data:{gid:this.model.get("id")},success:n.bind(function(t){this.model.set("version",t.version),this.model.set("isBookmarked",t.isBookmarked)},this)})},getLevelClassName:function(){return"level-"+this.model.get("levelName")},updateLastSeen:function(){var t=s(this.model.get("lastSeen"));this.$el.find(".last-seen").text(t.fromNow()).data("datetime",this.model.get("lastSeen")).attr("title",t.format("llll"))},updateCount:function(){var t=e.utils.formatNumber(this.model.get("count")),i=this.$el.find(".count"),a=i.find("span");if(a.is(":animated"))return!1;if(i.data("count")==t)return!1;i.data("count",t);var n=o("<span></span>",{css:{top:"-2.1em",opacity:0},text:t});a.before(n).animate({top:"2.5em",opacity:0},"fast",function(){a.remove()}),n.delay(100).animate({top:0,opacity:1},"fast")},updateAnnotation:function(t){var i=t.count;if(null!==i){var a=e.utils.formatNumber(i),n=this.$el.find('.annotation[data-tag="'+t.label+'"]'),s=n.find("span");if(s.is(":animated"))return!1;if(n.data("count")==a)return!1;n.data("count",a);var r=o("<span></span>",{css:{top:"-2.1em",opacity:0},text:a});s.before(r).animate({top:"2.5em",opacity:0},"fast",function(){s.remove()}),r.delay(100).animate({top:0,opacity:1},"fast")}},updateAllAnnotations:function(){var t=this;o.each(this.model.get("annotations"),function(e,i){t.updateAnnotation(i)})}}),e.OrderedElementsView=i.View.extend({loadingMessage:"<p>Loading...</p>",model:e.models.Group,defaults:{emptyMessage:"<p>There is no data to show.</p>",maxItems:50,view:i.View},initialize:function(t){n.isUndefined(t)&&(t={});var a=t.members;i.View.prototype.initialize.apply(this,arguments),this.options=o.extend({},this.defaults,this.options,t),this.$wrapper=o("#"+this.id),this.$parent=o("<ul></ul>"),this.$empty=o('<li class="empty"></li>'),this.$wrapper.html(this.$parent),this.options.className&&this.$parent.addClass(this.options.className),n.bindAll(this,"renderMemberInContainer","unrenderMember","reSortMembers"),this.collection=new e.ScoredList([],{model:t.model}),this.collection.on("add",this.renderMemberInContainer,this),this.collection.on("remove",this.unrenderMember,this),this.collection.on("reset",this.reSortMembers,this),delete t.members,this.reset(a)},reset:function(t){this.$parent.empty(),this.setEmpty(),void 0===t?(this.$empty.html(this.loadingMessage),this.collection.reset(),this.setEmpty(),this.loaded=!1):(this.$empty.html(this.options.emptyMessage),this.collection.reset(t),this.loaded=!0)},setEmpty:function(){this.$parent.html(this.$empty)},extend:function(t){for(var e=0;e<t.length;e++)this.addMember(t[e])},addMember:function(t){function e(e){return"function"==typeof t.get?t.get(e):t[e]}var i=this.collection.get(t.id);if(i){if(i.get("version")>=(e("version")||0))return}else if(this.collection.length>=this.options.maxItems){if(e("score")<this.collection.last().get("score"))return;for(;this.collection.length>=this.options.maxItems;)this.collection.pop()}this.collection.add(t,{merge:!0})},reSortMembers:function(){this.collection.each(n.bind(function(t){this.renderMemberInContainer(t)},this))},updateMember:function(t,e){n.isUndefined(e)&&(e={});var i=this.collection.get(t.id);i.get("version")>=t.get("version")||this.collection.add(t,{merge:!0,sort:e.sort!==!1?!0:!1})},hasMember:function(t){return this.collection.get(t.id)?!0:!1},removeMember:function(t){this.collection.remove(t)},renderMemberInContainer:function(t){var e,i,a=this.collection.indexOf(t);if(this.$parent.find("li.empty").remove(),e=o("#"+this.id+t.id),e.length){if(e.index()===a)return}else e=this.renderMember(t);if(0===a)this.$parent.prepend(e);else if(i=o("#"+this.id+this.collection.at(a).id),i.length){if(e.id===i.id)return;e.insertBefore(i)}else this.$parent.append(e);this.loaded&&e.css("background-color","#eee").animate({backgroundColor:"#fff"},300)},renderMember:function(t){var e=new this.options.view({model:t,id:this.id+t.id});return e.render(),e.$el},unrenderMember:function(t){this.$parent.find("#"+this.id+t.id).remove(),this.$parent.find("li").length||this.setEmpty()}}),e.GroupListView=e.OrderedElementsView.extend({defaults:{emptyMessage:"<p>There is no data to show.</p>",maxItems:50,realtime:!1,stream:!1,pollUrl:null,pollTime:1e3,tickTime:100},initialize:function(i){n.isUndefined(i)&&(i={}),i.model=e.models.Group,i.view=e.GroupView,e.OrderedElementsView.prototype.initialize.call(this,i),this.options=o.extend({},this.defaults,this.options,i),this.queue=new e.ScoredList([],{model:i.model}),this.cursor=null,n.bindAll(this,"poll","pollSuccess","pollFailure","tick"),this.poll(),t.setInterval(this.tick,this.options.tickTime)},tick:function(){if(this.queue.length){var t=this.queue.pop();this.options.canStream?this.addMember(t):this.hasMember(t)&&this.updateMember(t,{sort:!1})}},pollSuccess:function(i,a,n){if(!i.length)return t.setTimeout(this.poll,5*this.options.pollTime);var s=e.utils.parseLinkHeader(n.getResponseHeader("Link"));this.options.pollUrl=s.previous,this.queue.add(i,{merge:!0}),t.setTimeout(this.poll,this.options.pollTime)},pollFailure:function(e,i,a){t.setTimeout(this.poll,10*this.options.pollTime)},poll:function(){var i;return this.options.realtime&&this.options.pollUrl?(i=e.utils.getQueryParams(),i.cursor=this.cursor||void 0,void o.ajax({url:this.options.pollUrl,type:"GET",dataType:"json",data:i,success:this.pollSuccess,error:this.pollFailure})):t.setTimeout(this.poll,this.options.pollTime)}})}(window,app,Backbone,jQuery,_,moment),function(t,e,i,a,n){"use strict";var s=a,o=i.View.extend({defaults:{canStream:!1,realtime:!1},initialize:function(t){i.View.prototype.initialize.apply(this,arguments),n.isUndefined(t)&&(t={}),this.options=s.extend({},this.defaults,this.options,t),this.views={},this.initializeAjaxTabs()},initializeAjaxTabs:function(){s("a[data-toggle=ajtab]").click(n.bind(function(t){var e,i,a=s(t.target),n=a.attr("data-uri"),o=a.attr("href").substr(1),r=this.getView(o,n);return t.preventDefault(),n?(e=s("#"+o),i=e.parent(),i.css("opacity",.6),void s.ajax({url:n,dataType:"json",success:function(t){r.reset(t),i.css("opacity",1),a.tab("show")},error:function(){e.html("<p>There was an error fetching data from the server.</p>")}})):r.reset()},this)),s("li.active a[data-toggle=ajtab]").click()},makeDefaultView:function(t){return new e.GroupListView({emptyMessage:"<p>There are no events to show.</p>",className:"group-list small",id:t,maxItems:5,stream:this.options.stream,realtime:this.options.realtime,model:e.models.Group})},getView:function(t,e){this.views[t]||(this.views[t]=this.makeDefaultView(t));var i=this.views[t];return i.options.pollUrl=e,i}});e.StreamPage=o.extend({initialize:function(t){o.prototype.initialize.apply(this,arguments),this.group_list=new e.GroupListView({className:"group-list",id:"event_list",members:t.groups,maxItems:50,realtime:s.cookie("pausestream")?!1:!0,canStream:this.options.canStream,pollUrl:e.config.urlPrefix+"/api/"+e.config.organizationId+"/"+e.config.projectId+"/poll/",model:e.models.Group,emptyMessage:s("#empty_message").html()}),this.control=s("a[data-action=pause]"),this.updateStreamOptions(),this.initFilters(),this.control.click(n.bind(function(t){t.preventDefault(),this.options.realtime=this.group_list.options.realtime=this.control.hasClass("realtime-pause"),this.updateStreamOptions()},this)),s("#chart").height("50px"),e.charts.render("#chart",{placement:"left"})},initFilters:function(){s(".filter").each(n.bind(function(i,a){var n=s(a),o=n.find("input[type=text]");o.length>0?o.select2({initSelection:function(t,e){var i=s(t);e({id:i.val(),text:i.val()})},allowClear:!0,minimumInputLength:3,ajax:{url:e.utils.getSearchTagsUrl(),dataType:"json",data:function(t,e){return{query:t,quietMillis:300,name:o.attr("name"),limit:10}},results:function(t,i){var a=[];return s(t.results).each(function(t,i){a.push({id:e.utils.escape(i),text:e.utils.escape(i)})}),{results:a}}}}):o=n.find("select").select2({allowClear:!0}),o.length>0&&o.on("change",function(i){var a=e.utils.getQueryParams();a[i.target.name]=i.val,t.location.href="?"+s.param(a)})},this))},updateStreamOptions:function(){this.options.realtime?(s.removeCookie("pausestream"),this.control.removeClass("realtime-pause"),this.control.addClass("realtime-play"),this.control.html(this.control.attr("data-pause-label"))):(s.cookie("pausestream","1",{expires:7}),this.control.addClass("realtime-pause"),this.control.removeClass("realtime-play"),this.control.html(this.control.attr("data-play-label")))}}),e.DashboardPage=o.extend({initialize:function(t){o.prototype.initialize.apply(this,arguments),s("#chart").height("150px"),Sentry.charts.render("#chart")}}),e.GroupDetailsPage=o.extend({initialize:function(i){o.prototype.initialize.apply(this,arguments),this.group_list=new e.GroupListView({className:"group-list",id:"event_list",members:[i.group],model:e.models.Group}),s("#chart").height("150px"),Sentry.charts.render("#chart"),s(".share-link").popover({html:!0,placement:"left",container:document.body,title:"Share Event",content:function(){var i=s(this),a=s('<form class="share-form"></form>'),n=s('<code class="clippy">'+i.data("share-url")+"</code>"),o=i.data("public");n.clippy({clippy_path:e.config.clippyPath,keep_text:!0}),a.append(n),a.append(s('<label class="checkbox"><input type="checkbox"'+(o?' checked="checked"':"")+"/>Allow anonymous users to view this event.</label>"));a.find("input[type=checkbox]").change(function(){var e=i.data(s(this).is(":checked")?"public-url":"private-url");s.ajax({url:e,type:"post",success:function(t){i.data("public",t.isPublic)},error:function(){t.alert("There was an error changing the public status")}})});return a}}),s(".add-note-btn").click(function(t){var e=s(this),i=s(".add-note-form",e.parent());t.preventDefault(),e.hasClass("selected")?(e.removeClass("selected"),i.addClass("hide")):(e.addClass("selected"),i.removeClass("hide"),i.find("textarea:first").focus())}),s(".add-note-form").submit(function(t){var e=s(this);e.find("button[type=submit]").attr("disabled",!0).addClass("disabled"),e.find("textarea").addClass("disabled")}),s(".tag-widget").each(function(){var t=s(this);s.ajax({url:t.data("url"),error:function(){t.find(".loading").remove(),t.append(s('<li class="error">Unable to load tag information</li>'))},success:function(i){var a=i.total,n=encodeURIComponent(i.name);t.find(".loading").remove(),0===a?t.append(s("<li>No data available.</li>")):s.each(i.values,function(i,o){var r=o.value,l=o.count,c=e.utils.escape(o.label||o.value),d=parseInt(l/a*100,10),h=e.config.urlPrefix+"/"+e.config.organizationId+"/"+e.config.projectId+"/";s('<li><div class="progressbar"><div style="width:'+d+'%">'+l+'</div><a href="'+h+"?"+n+"="+encodeURIComponent(r)+'">'+c+"<span>"+d+"%</span></a></div></li>").appendTo(t)})}})});var a=s("#event_nav");if(a.length>0){var n,r,l=s(t),c=a.find("a[href*=#]"),d=[],h=a.offset().top;l.resize(function(){n=a.find(".nav").outerHeight(),a.height(n+"px")}).resize(),c.click(function(t){var e=s(this),i=s(this.hash);e.parent().addClass("active").siblings().removeClass("active"),s("html,body").animate({scrollTop:i.position().top+n},"fast"),history.pushState&&history.pushState({},"",this.hash),t.preventDefault()}).each(function(){this.hash.length>1&&s(this.hash).length&&d.push(this.hash)});var p;l.scroll(function(){clearTimeout(p),p=setTimeout(function(){if(l.scrollTop()>h?a.hasClass("fixed")||a.addClass("fixed"):a.hasClass("fixed")&&a.removeClass("fixed"),d.length){var t=l.scrollTop()+n+20,e=s.map(d,function(e){return s(e).offset().top<t?e:void 0}),i=e?e[e.length-1]:null;i||(i=d[0]),r!==i&&(r=i,c.parent().removeClass("active").end().filter("[href="+i+"]").parent().addClass("active"))}},1)}).scroll()}}}),e.WallPage=o.extend({initialize:function(){o.prototype.initialize.apply(this,{realtime:!0,pollTime:3e3}),this.sparkline=s(".chart"),this.sparkline.height(this.sparkline.parent().height()),this.stats=s("#stats"),n.bindAll(this,"refreshStats","refreshSparkline"),this.refreshSparkline(),this.refreshStats()},makeDefaultView:function(t){return new e.GroupListView({className:"group-list",id:t,maxItems:5,stream:this.options.stream,realtime:this.options.realtime,model:e.models.Group})},refreshSparkline:function(){s.ajax({url:this.sparkline.attr("data-api-url"),type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-86400,resolution:"1h"},success:n.bind(function(e){for(var i=0;i<e.length;i++)e[i][0]=1e3*e[i][0];this.sparkline.empty(),s.plot(this.sparkline,[{data:e,color:"#52566c",shadowSize:0,lines:{lineWidth:2,show:!0,fill:!0,fillColor:"#232428"}}],{yaxis:{min:0},grid:{show:!1},hoverable:!1,legend:{noColumns:5},lines:{show:!1}}),t.setTimeout(this.refreshSparkline,1e4)},this)})},refreshStats:function(){s.ajax({url:this.stats.attr("data-uri"),dataType:"json",success:n.bind(function(e){this.stats.find("[data-stat]").each(function(){var t=s(this),i=e[t.attr("data-stat")],a=t.find("big"),n=a.find("span");if(n.is(":animated"))return!1;if(a.data("count")==i)return!1;a.data("count",i);var o=s("<span></span>",{css:{top:"-2.1em",opacity:0},text:i});n.before(o).animate({top:"2.5em",opacity:0},"fast",function(){n.remove()}),o.delay(100).animate({top:0,opacity:1},"fast")}),t.setTimeout(this.refreshStats,1e3)},this)})}}),e.TeamDetailsPage=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),e.utils.makeSearchableUsersInput("form input[name=owner]")}}),e.ProjectDetailsPage=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),e.utils.makeSearchableUsersInput("form input[name=owner]"),s("input[name='scrub_data']").change(function(){s(this).is(":checked")?s("#div_id_sensitive_fields").show():s("#div_id_sensitive_fields").hide()}).change(),s("input[type=range]").each(n.bind(function(t,e){for(var i=s(e),a=parseInt(i.attr("min"),10),o=parseInt(i.attr("max"),10),r=parseInt(i.attr("step"),10),l=[],c=s('<span class="value"></span>'),d=a;o>=d;)l.push(d),d+=12>d?1:24>d?3:36>d?6:48>d?12:24;i.on("slider:ready",n.bind(function(t,e){c.appendTo(e.el),c.html(this.formatHours(e.value))},this)).on("slider:changed",n.bind(function(t,e){c.html(this.formatHours(e.value))},this)).simpleSlider({range:[a,o],step:r,allowedValues:l,snap:!0})},this))},formatHours:function(t){return t=parseInt(t,10),0===t?"Disabled":t>23&&t%24===0?(t/=24,t+" day"+(1!=t?"s":"")):t+" hour"+(1!=t?"s":"")}}),e.ProjectNotificationsPage=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),s("input[type=range]").each(n.bind(function(t,e){var i=s(e),a=parseInt(i.attr("min"),10),o=parseInt(i.attr("max"),10),r=parseInt(i.attr("step"),10),l=s('<span class="value"></span>');i.on("slider:ready",n.bind(function(t,e){l.appendTo(e.el),l.html(this.formatThreshold(e.value))},this)).on("slider:changed",n.bind(function(t,e){l.html(this.formatThreshold(e.value))},this)).simpleSlider({range:[a,o],step:r,snap:!0})},this))},formatThreshold:function(t){return t?t+"%":"Disabled"}}),e.NewProjectPage=o.extend({initialize:function(t){this.el=s(t.el),o.prototype.initialize.apply(this,arguments),this.options.canSelectTeam&&this.options.canCreateTeam&&(s("#new_team").hide(),s('a[rel="create-new-team"]').click(function(){s("#new_team").show(),s("#select_team").hide()}),s('a[rel="select-team"]').click(function(){s("#new_team").hide(),s("#select_team").show()}))}}),e.NewProjectRulePage=o.extend({initialize:function(t){var e={width:"element",allowClear:!1,minimumResultsForSearch:10};o.prototype.initialize.apply(this,arguments),n.bindAll(this,"addAction","addCondition","parseFormData"),this.actions_by_id={},this.conditions_by_id={},this.el=s(t.el),this.action_sel=this.el.find('select[id="action-select"]'),this.action_table=this.el.find("table.action-list"),this.action_table_body=this.action_table.find("tbody"),this.condition_sel=this.el.find('select[id="condition-select"]'),this.condition_table=this.el.find("table.condition-list"),this.condition_table_body=this.condition_table.find("tbody"),this.action_sel.empty(),this.action_sel.append(s("<option></option>")),s.each(t.actions,n.bind(function(t,e){var i=s("<option></option>");i.attr({value:e.id}),i.text(e.label),i.appendTo(this.action_sel),this.actions_by_id[e.id]=e},this)),this.condition_sel.empty(),this.condition_sel.append(s("<option></option>")),s.each(t.conditions,n.bind(function(t,e){var i=s("<option></option>");i.attr({value:e.id}),i.text(e.label),i.appendTo(this.condition_sel),this.conditions_by_id[e.id]=e},this)),this.action_sel.select2(e),this.condition_sel.select2(e),this.action_sel.change(n.bind(function(){var t=this.action_sel.val();t&&this.addAction(t)},this)),this.condition_sel.change(n.bind(function(){var t=this.condition_sel.val();t&&this.addCondition(t)},this)),this.parseFormData(t.form_data,t.form_errors)},parseFormData:function(t,e){var i={action:{},action_match:t.action_match||"all",condition:{},label:t.label||""};e=e||{},s.each(t,function(t,e){var a,n,s=t.match(/^(condition|action)\[(\d+)\]\[(.+)\]$/);s&&(a=s[1],n=s[2],void 0===i[a][n]&&(i[a][n]={}),i[a][n][s[3]]=e)}),this.el.find("input[name=label]").val(i.label),this.el.find('select[name="action_match"]').val(i.action_match),s.each(n.sortBy(i.condition),n.bind(function(t,i){this.addCondition(i.id,i,e["condition["+t+"]"]||!1)},this)),s.each(n.sortBy(i.action),n.bind(function(t,i){this.addAction(i.id,i,e["action["+t+"]"]||!1)},this))},addInputRow:function(t,e,i,a,n){var o=t.find("tr").length;e=e+"["+o+"]",n=n||!1,a=a||{};var r=s("<tr></tr>"),l=s('<button class="btn btn-small">Remove</button>'),c=s("<div>"+i.html+"</div>"),d=s('<input type="hidden" name="'+e+'[id]" value="'+i.id+'">');n&&r.addClass("error"),c.find("input, select, textarea").each(function(t,i){var n=s(i),o=n.attr("name");n.attr("name",e+"["+o+"]"),n.val(a[o]||"")}),c.find("input.typeahead").each(function(){var t=s(this),e={initSelection:function(t,e){var i=s(t);e({id:i.val(),text:i.val()})},data:t.data("choices"),createSearchChoice:function(t){return{id:s.trim(t),text:s.trim(t)}}};t.select2(e)}),c.find("select").each(function(){var t=s(this),e={width:"element",allowClear:!1,minimumResultsForSearch:10};t.data("allow-clear")&&(e.allowClear=t.data("allow-clear")),t.select2(e)}),r.append(s("<td></td>").append(c).append(d)),r.append(s("<td></td>").append(l)),r.appendTo(t),l.click(function(){return r.remove(),!1})},addCondition:function(t,e,i){this.addInputRow(this.condition_table_body,"condition",this.conditions_by_id[t],e,i),this.condition_sel.data("select2").clear(),this.condition_table.show()},addAction:function(t,e,i){this.addInputRow(this.action_table_body,"action",this.actions_by_id[t],e,i),this.action_sel.data("select2").clear(),this.action_table.show()}}),i.sync=function(t,e,i,a){i()}}(window,app,Backbone,jQuery,_);